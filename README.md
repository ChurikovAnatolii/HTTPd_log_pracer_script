# UNIT9_BASH

### Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.
___
***Для запуска скрипта каждый час кладем его в папку /etc/cron.hourly***

***Описание работы [скрипта](https://github.com/ChurikovAnatolii/UNIT9_BASH/blob/main/unit_script.sh)***
___


-**После запуска в Section 1- создаем функцию (clean), которая будет удалять все временные файлы при прерывании выполнения скрипта, для этого используем trap**

-**Далее в Section 2 создаем lock- файл (/var/lock/unit_script.lock) для предотвращения повторного запуска нескольких копий. Если скрипт запущен на исполнение, то при попытке запуска еще одной копии ее исполнение будет прервано, так как пока скрипт исполняется файл существует.**

-**Далее в Section 3 скрипт выполняет проверку на наличие в текущем каталоге файла с датой предыдущего запуска, если файл еще не создан то создаст его и добавит в него дату "14/Aug/2019:00:00:00" - для того, чтобы в первый раз пройти лог целиком. Если файл уже создан то выведет на экран время из него. В конце исполднения скрипта запишеn в этот файл текущую дату для следующего запуска.**

-**Для вывода лога с момента последнего запуска скрипта в Section 4 напишем функцию (valid_time), которая будет читать дату начала лога из ранее созданого файла с временем последнего запуска и с помощью awk будет создавать временный лог-файл (log.tmp), в котором будут содержаться записи между временем последнего запуска скрипта и текущим временем.**

-**В Section 5 опишем функцию (best_ip), которая фильтрует уже сокращенный по времени лог(tmp.log) и выводит на экран 3 наиболее часто встречающихся IP-адреса.**

-**В Section 6 опишем функцию (best_http), которая фильтрует уже сокращенный по времени лог(tmp.log) и выводит на экран 3 наиболее часто встречающихся HTTP-запроса.**

-**В Section 7 опишем функцию (http_code), которая фильтрует уже сокращенный по времени лог(tmp.log) и выводит на экран  все HTTP- коды.**

-**В Section 8 опишем функцию (http_bad_codes), которая фильтрует уже сокращенный по времени лог(tmp.log) и выводит на экран  все ошибочные HTTP- коды.** 

-**В Section 9 запускаем функцию valid_time, формируем временный лог с диапозоном времени от последненго запуска до текущего времени.**

-**В Section 10 при не пустом логе (log.tmp) формируем вывод в файл result.log последовательно запуская функции фильтры, если лог(log.tmp), пустой то выводим в файл result.log диапозон времени и сообщение о том, что изменений в данный период времени нет.**  

-**Далее в Section 11 удаляем lock-файл и добавляем время запуска скрипта в last_launch.log для дальнейшего использования**

-**В Section 12 отправляем файл result.log по почте**

---

## Проверки работоспособности.

---
-**Проверки роводились с использованием [файла лога](https://github.com/ChurikovAnatolii/UNIT9_BASH/blob/main/access.log)**

-**Проверка 1 - запуск скрипта без файла с записью о последнем запуске:[результат](https://github.com/ChurikovAnatolii/UNIT9_BASH/blob/main/result1.log) с прохождением всего лога с начала и до конца**

-**Проверка 2 - запуск скрипта c наличием файла с записью о последнем запуске:[результат](https://github.com/ChurikovAnatolii/UNIT9_BASH/blob/main/result2.log) с отсутсвием записей**

-**Проверка 3 - запуск скрипта c наличием файла с записью о последнем запуске, при этом вручную в файл вставлено время внутри временного диапозона лога (14/Aug/2019:21:04:11): [результат](https://github.com/ChurikovAnatolii/UNIT9_BASH/blob/main/result3.log) с ограниченным диапозоном записей**

---